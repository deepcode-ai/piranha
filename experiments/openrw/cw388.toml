[[rules]]
name = "find_class"
query = "cs public final class RandomUtil :[b]"


[[rules]]
name = "delete_fields"
query = "(field_declaration) @fd"
replace_node = "fd"
replace = ""
[[rules.filters]]
enclosing_node = "(class_declaration) @cd"
not_contains = ["rgx SECURE_RANDOM"]

[[rules]]
name = "append_new_fields"
query = """(class_declaration
	name: (_) @name
    body: (class_body
    			(_) @first
                (_)+ @stmts) @body)
"""
replace_node="first"
replace = """private static final SecureRandom SECURE_RANDOM = new SecureRandom();
  private static final int DEF_COUNT = 20;

  static {
      SECURE_RANDOM.nextBytes(new byte[64]);
  }

  private static String generateRandomAlphanumericString() {
      return RandomStringUtils.random(DEF_COUNT, 0, 0, true, true, null, SECURE_RANDOM);
  }

  @first
"""
[[rules.filters]]
enclosing_node = "(class_declaration) @cd"
not_contains = ["rgx SECURE_RANDOM"]

[[rules]]
name = "replace_methods_body"
query = """
(method_declaration
	body: (_) @block) @md
"""
replace_node = "block"
replace = "{ return generateRandomAlphanumericString(); }"
[[rules.filters]]
enclosing_node = "(method_declaration) @method"
not_contains = ["rgx generateRandomAlphanumericString"]


[[edges]]
from = "find_class"
to = ["delete_fields"]
scope = "Class"

[[edges]]
from = "delete_fields"
to = ["append_new_fields"]
scope = "Class"

[[edges]]
from = "append_new_fields"
to = ["replace_methods_body"]
scope = "Class"
