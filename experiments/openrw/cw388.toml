[[rules]]
name = "find_class"
match = "cs class RandomUtil :[b]"

[[rules]]
name = "delete_fields"
match = "(field_declaration) @fd"
replace = "fd"
replace_string = ""

[[rules]]
name = "append_new_fields"
match = """(class_declaration
	name: (_) @name
    body: (class_body
    			(_)+ @stmts) @body)
"""
replace="stmts"
replace_string = """
private static final SecureRandom SECURE_RANDOM = new SecureRandom();
private static final int DEF_COUNT = 20;

static {
    SECURE_RANDOM.nextBytes(new byte[64]);
}

private static String generateRandomAlphanumericString() {
    return RandomStringUtils.random(DEF_COUNT, 0, 0, true, true, null, SECURE_RANDOM);
}

@stmts
"""
[[rules.filters]]
not_contains = "rgx SECURE_RANDOM"

[[rules]]
name = "replace_methods_body"
match = """
(method_declaration
	body: (_) @block)
"""
replace = "block"
replace_string = "{ return generateRandomAlphanumericString(); }"
[[rules.filters]]
not_contains = "rgx generateRandomAlphanumericString"

[[edges]]
from = "find_class"
to = "delete_fields"
scope = "class"

[[edges]]
from = "delete_fields"
to = "append_new_fields"
scope = "class"

[[edges]]
from = "append_new_fields"
to = "replace_methods_body"
scope = "class"